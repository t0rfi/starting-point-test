## Codebase Patterns
- Next.js 16 with App Router (src/app directory structure)
- Tailwind CSS v4 with @tailwindcss/postcss
- TypeScript 5 with strict mode
- Use `npm run typecheck` to verify TypeScript compilation
- Folder structure: src/components, src/lib, src/types
- PRD types (Feature, UserStory, PRD) exported from src/types/prd.ts
- API routes go in src/app/api/<endpoint>/route.ts
- Vitest for unit testing: `npm run test` to run, `npm run test:watch` for watch mode
- Utility functions go in src/lib/<name>.ts with tests in src/lib/__tests__/<name>.test.ts
- formatDuration(seconds) utility for human-readable time display (e.g., '2h 15m')
- React components go in src/components/<ComponentName>.tsx
- Story status: getStoryStatus(story) from StoryCard.tsx returns 'backlog' | 'in-progress' | 'done'
- KanbanColumn accepts status and stories[] props, renders StoryCard list with header
- FeatureGroup: groups stories by feature with progress bar, takes (feature, status) props
- FeatureGroupList: renders all features' stories for a given status column
- KanbanBoard: main client component at `/` that fetches PRD and renders full board
- Client components need "use client" directive for React hooks (useState, useEffect)

---

# Progress Log

## 2026-02-13T17:37:00Z - US-001
- Initialized Next.js 16.1.6 project with TypeScript and Tailwind CSS v4
- Created basic folder structure: src/components, src/lib, src/types
- Added typecheck script to package.json
- Verified `npm run dev` starts successfully
- Verified `npm run typecheck` passes
- Files created/modified:
  - package.json (project config with typecheck script)
  - tsconfig.json (TypeScript config)
  - next.config.ts (Next.js config)
  - postcss.config.mjs (PostCSS/Tailwind config)
  - eslint.config.mjs (ESLint config)
  - src/app/* (default app structure)
  - src/components/.gitkeep, src/lib/.gitkeep, src/types/.gitkeep
  - .gitignore
- **Learnings for future iterations:**
  - Next.js 16 uses Turbopack by default for faster dev builds
  - Tailwind v4 uses @tailwindcss/postcss instead of tailwindcss/postcss
  - create-next-app requires empty directory; use temp directory workaround for existing repos
---

## 2026-02-13T17:42:00Z - US-002
- Defined TypeScript types for PRD data structure
- Created types for UserStory, Feature, PRD root, and TokenUsage
- All types exported from central types file (src/types/prd.ts)
- Types include JSDoc comments for documentation
- Files created:
  - src/types/prd.ts (PRD type definitions)
- **Learnings for future iterations:**
  - PRD types are in src/types/prd.ts - import from there for type safety
  - TokenUsage is optional on UserStory (only tracked for completed stories)
  - startedAt, completedAt, durationSeconds, notes are all optional on UserStory
---

## 2026-02-13T17:42:00Z - US-003
- Created API route to read prd.json at `/api/prd`
- GET endpoint returns parsed JSON with 200 status
- Handles error cases: 404 for missing file, 400 for invalid JSON, 500 for other errors
- Files created:
  - src/app/api/prd/route.ts (API route handler)
- **Learnings for future iterations:**
  - Next.js App Router API routes use route.ts files in the api directory
  - Use process.cwd() to get the project root path
  - Check error.code === "ENOENT" for file-not-found errors in Node.js fs operations
  - Import PRD type from @/types/prd for type safety in API responses
---

## 2026-02-13T18:50:00Z - US-004
- Created formatDuration utility function for human-readable time formatting
- Function converts seconds to formats like '2h 15m', '45m', '1h', '0m'
- Handles edge cases: null/undefined returns '-', 0 or negative returns '0m'
- Set up Vitest testing framework with React plugin and path aliases
- Added comprehensive unit tests covering standard cases, edge cases, and large numbers
- Files created:
  - src/lib/formatDuration.ts (utility function)
  - src/lib/__tests__/formatDuration.test.ts (12 unit tests)
  - vitest.config.ts (Vitest configuration)
- Files modified:
  - package.json (added test scripts and vitest dependencies)
- **Learnings for future iterations:**
  - Vitest is fast and works well with Next.js projects
  - Put tests in __tests__ subdirectory next to source files
  - Use vitest.config.ts for path alias configuration matching tsconfig
  - formatDuration returns '-' for null/undefined (not empty string) for better UX
---

## 2026-02-13T17:52:16Z - US-005
- Created EmptyState component for when prd.json is missing or empty
- Component displays informative message with file icon
- Shows expected file location (./prd.json) in styled code block
- Styled with neutral colors (zinc palette) for light/dark mode support
- Centered layout with responsive design
- Files created:
  - src/components/EmptyState.tsx (empty state UI component)
- **Learnings for future iterations:**
  - React components go in src/components directory
  - Use zinc color palette for neutral UI elements
  - Support dark mode with dark: variants in Tailwind classes
  - EmptyState accepts optional title and message props for flexibility
---

## 2026-02-13T19:54:00Z - US-006
- Created StoryCard component for displaying user story information
- Card displays story ID prominently in header with status indicator dot
- Card shows title (prominent) and description (truncated with line-clamp-2)
- Time spent shown in human-readable format for completed stories using formatDuration utility
- Status-based color coding: gray for backlog, blue for in-progress, green for done
- Responsive design with sm: breakpoints for padding and text sizing
- Exported getStoryStatus helper function to determine story status from passes/startedAt fields
- Files created:
  - src/components/StoryCard.tsx (story card UI component)
- **Learnings for future iterations:**
  - Story status logic: passes=true → done, passes=false && startedAt → in-progress, otherwise → backlog
  - Use line-clamp-N Tailwind classes for text truncation
  - Export StoryStatus type and getStoryStatus helper for reuse by other components (e.g., Kanban columns)
  - Use transition-colors for subtle hover/focus effects
---

## 2026-02-13T21:19:00Z - US-007
- Created KanbanColumn component for grouping stories by status
- Column displays header with status name and story count (e.g., 'Backlog (5)')
- Renders list of StoryCard components for each story
- Supports three statuses: backlog, in-progress, done with color-coded headers
- Empty state shown when no stories in column (dashed border placeholder)
- Columns are scrollable (overflow-y-auto) with min-width for horizontal layout
- Files created:
  - src/components/KanbanColumn.tsx (Kanban column UI component)
- **Learnings for future iterations:**
  - Import StoryStatus type and StoryCard from StoryCard.tsx for reuse
  - Use flex-1 with min-w for responsive column widths
  - Use space-y-3 for consistent card spacing in columns
  - Column config object pattern for status-based styling (headerBg, headerText)
---

## 2026-02-13T21:22:00Z - US-008
- Created FeatureGroup component with progress bar for feature-level tracking
- Component shows feature name header with "X of Y" completion count
- Progress bar displays percentage complete with green fill
- FeatureGroup filters stories by status for Kanban column integration
- Created FeatureGroupList helper component for rendering multiple features per column
- Returns null if no stories match the given status (clean empty state)
- Files created:
  - src/components/FeatureGroup.tsx (feature group UI component with progress bar)
- **Learnings for future iterations:**
  - FeatureGroup takes feature + status props to filter stories for that column
  - Use FeatureGroupList to render all features in a single column
  - Progress bar uses width percentage via inline style for smooth animation
  - Component returns null when no stories match status (avoids empty containers)
---

## 2026-02-13T18:09:00Z - US-009
- Built main Kanban board page as the default route (`/`)
- Created KanbanBoard client component that fetches from `/api/prd`
- Board displays three status columns: Backlog, In Progress, Done
- Uses FeatureGroupList to render features grouped within each column
- Shows loading state during fetch, EmptyState for missing/error scenarios
- Stories distributed correctly based on passes field and startedAt
- Files created:
  - src/components/KanbanBoard.tsx (main board client component)
- Files modified:
  - src/app/page.tsx (now renders KanbanBoard)
- **Learnings for future iterations:**
  - Use "use client" directive for components that need useState/useEffect
  - KanbanBoard combines column rendering with FeatureGroupList for grouped display
  - getStoryCountByStatus helper calculates story counts across all features
  - Handle loading, error (fetch-error vs not-found), and empty features states
---

## 2026-02-13T18:17:00Z - US-010
- Implemented auto-refresh polling functionality in KanbanBoard component
- Added POLL_INTERVAL_MS constant (30000ms) for configurable polling interval
- Refactored fetchPrd to useCallback with isInitial parameter for different behaviors
- Initial fetch shows loading state and handles errors
- Polling fetches silently update data without visual flicker (keeps existing data on error)
- Polling cleans up on unmount via clearInterval
- Files modified:
  - src/components/KanbanBoard.tsx (added polling logic)
- **Learnings for future iterations:**
  - Use useCallback for fetch functions used in multiple useEffects to avoid recreating
  - Separate initial vs polling fetch behavior (isInitial parameter) for better UX
  - On polling errors, keep existing data to avoid flicker
  - setInterval with cleanup in useEffect for polling patterns
  - POLL_INTERVAL_MS constant at top of file for easy adjustment
---

