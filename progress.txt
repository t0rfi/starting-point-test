## Codebase Patterns
- Next.js 16 with App Router (src/app directory structure)
- Tailwind CSS v4 with @tailwindcss/postcss
- TypeScript 5 with strict mode
- Use `npm run typecheck` to verify TypeScript compilation
- Folder structure: src/components, src/lib, src/types
- PRD types (Feature, UserStory, PRD) exported from src/types/prd.ts
- API routes go in src/app/api/<endpoint>/route.ts
- Vitest for unit testing: `npm run test` to run, `npm run test:watch` for watch mode
- Utility functions go in src/lib/<name>.ts with tests in src/lib/__tests__/<name>.test.ts
- formatDuration(seconds) utility for human-readable time display (e.g., '2h 15m')
- React components go in src/components/<ComponentName>.tsx
- Story status: getStoryStatus(story) from StoryCard.tsx returns 'backlog' | 'in-progress' | 'done'
- KanbanColumn accepts status and stories[] props, renders StoryCard list with header
- FeatureGroup: groups stories by feature with progress bar, takes (feature, status) props
- FeatureGroupList: renders all features' stories for a given status column
- KanbanBoard: main client component at `/` that fetches PRD and renders full board
- Client components need "use client" directive for React hooks (useState, useEffect)
- Tailwind CSS v4 dark mode: use @custom-variant dark (&:where(.dark, .dark *)) in globals.css
- Theme toggle: apply 'dark' class to document.documentElement for class-based dark mode
- Local storage keys: 'kanban-tracker-view' for view mode, 'kanban-tracker-theme' for theme
- Mobile responsiveness: use snap-x snap-mandatory for horizontal scroll, 85vw columns
- Touch targets: min-h-[36px] min-w-[36px], touch-manipulation, active:scale-95 feedback

---

# Progress Log

## 2026-02-13T17:37:00Z - US-001
- Initialized Next.js 16.1.6 project with TypeScript and Tailwind CSS v4
- Created basic folder structure: src/components, src/lib, src/types
- Added typecheck script to package.json
- Verified `npm run dev` starts successfully
- Verified `npm run typecheck` passes
- Files created/modified:
  - package.json (project config with typecheck script)
  - tsconfig.json (TypeScript config)
  - next.config.ts (Next.js config)
  - postcss.config.mjs (PostCSS/Tailwind config)
  - eslint.config.mjs (ESLint config)
  - src/app/* (default app structure)
  - src/components/.gitkeep, src/lib/.gitkeep, src/types/.gitkeep
  - .gitignore
- **Learnings for future iterations:**
  - Next.js 16 uses Turbopack by default for faster dev builds
  - Tailwind v4 uses @tailwindcss/postcss instead of tailwindcss/postcss
  - create-next-app requires empty directory; use temp directory workaround for existing repos
---

## 2026-02-13T17:42:00Z - US-002
- Defined TypeScript types for PRD data structure
- Created types for UserStory, Feature, PRD root, and TokenUsage
- All types exported from central types file (src/types/prd.ts)
- Types include JSDoc comments for documentation
- Files created:
  - src/types/prd.ts (PRD type definitions)
- **Learnings for future iterations:**
  - PRD types are in src/types/prd.ts - import from there for type safety
  - TokenUsage is optional on UserStory (only tracked for completed stories)
  - startedAt, completedAt, durationSeconds, notes are all optional on UserStory
---

## 2026-02-13T17:42:00Z - US-003
- Created API route to read prd.json at `/api/prd`
- GET endpoint returns parsed JSON with 200 status
- Handles error cases: 404 for missing file, 400 for invalid JSON, 500 for other errors
- Files created:
  - src/app/api/prd/route.ts (API route handler)
- **Learnings for future iterations:**
  - Next.js App Router API routes use route.ts files in the api directory
  - Use process.cwd() to get the project root path
  - Check error.code === "ENOENT" for file-not-found errors in Node.js fs operations
  - Import PRD type from @/types/prd for type safety in API responses
---

## 2026-02-13T18:50:00Z - US-004
- Created formatDuration utility function for human-readable time formatting
- Function converts seconds to formats like '2h 15m', '45m', '1h', '0m'
- Handles edge cases: null/undefined returns '-', 0 or negative returns '0m'
- Set up Vitest testing framework with React plugin and path aliases
- Added comprehensive unit tests covering standard cases, edge cases, and large numbers
- Files created:
  - src/lib/formatDuration.ts (utility function)
  - src/lib/__tests__/formatDuration.test.ts (12 unit tests)
  - vitest.config.ts (Vitest configuration)
- Files modified:
  - package.json (added test scripts and vitest dependencies)
- **Learnings for future iterations:**
  - Vitest is fast and works well with Next.js projects
  - Put tests in __tests__ subdirectory next to source files
  - Use vitest.config.ts for path alias configuration matching tsconfig
  - formatDuration returns '-' for null/undefined (not empty string) for better UX
---

## 2026-02-13T17:52:16Z - US-005
- Created EmptyState component for when prd.json is missing or empty
- Component displays informative message with file icon
- Shows expected file location (./prd.json) in styled code block
- Styled with neutral colors (zinc palette) for light/dark mode support
- Centered layout with responsive design
- Files created:
  - src/components/EmptyState.tsx (empty state UI component)
- **Learnings for future iterations:**
  - React components go in src/components directory
  - Use zinc color palette for neutral UI elements
  - Support dark mode with dark: variants in Tailwind classes
  - EmptyState accepts optional title and message props for flexibility
---

## 2026-02-13T19:54:00Z - US-006
- Created StoryCard component for displaying user story information
- Card displays story ID prominently in header with status indicator dot
- Card shows title (prominent) and description (truncated with line-clamp-2)
- Time spent shown in human-readable format for completed stories using formatDuration utility
- Status-based color coding: gray for backlog, blue for in-progress, green for done
- Responsive design with sm: breakpoints for padding and text sizing
- Exported getStoryStatus helper function to determine story status from passes/startedAt fields
- Files created:
  - src/components/StoryCard.tsx (story card UI component)
- **Learnings for future iterations:**
  - Story status logic: passes=true → done, passes=false && startedAt → in-progress, otherwise → backlog
  - Use line-clamp-N Tailwind classes for text truncation
  - Export StoryStatus type and getStoryStatus helper for reuse by other components (e.g., Kanban columns)
  - Use transition-colors for subtle hover/focus effects
---

## 2026-02-13T21:19:00Z - US-007
- Created KanbanColumn component for grouping stories by status
- Column displays header with status name and story count (e.g., 'Backlog (5)')
- Renders list of StoryCard components for each story
- Supports three statuses: backlog, in-progress, done with color-coded headers
- Empty state shown when no stories in column (dashed border placeholder)
- Columns are scrollable (overflow-y-auto) with min-width for horizontal layout
- Files created:
  - src/components/KanbanColumn.tsx (Kanban column UI component)
- **Learnings for future iterations:**
  - Import StoryStatus type and StoryCard from StoryCard.tsx for reuse
  - Use flex-1 with min-w for responsive column widths
  - Use space-y-3 for consistent card spacing in columns
  - Column config object pattern for status-based styling (headerBg, headerText)
---

## 2026-02-13T21:22:00Z - US-008
- Created FeatureGroup component with progress bar for feature-level tracking
- Component shows feature name header with "X of Y" completion count
- Progress bar displays percentage complete with green fill
- FeatureGroup filters stories by status for Kanban column integration
- Created FeatureGroupList helper component for rendering multiple features per column
- Returns null if no stories match the given status (clean empty state)
- Files created:
  - src/components/FeatureGroup.tsx (feature group UI component with progress bar)
- **Learnings for future iterations:**
  - FeatureGroup takes feature + status props to filter stories for that column
  - Use FeatureGroupList to render all features in a single column
  - Progress bar uses width percentage via inline style for smooth animation
  - Component returns null when no stories match status (avoids empty containers)
---

## 2026-02-13T18:09:00Z - US-009
- Built main Kanban board page as the default route (`/`)
- Created KanbanBoard client component that fetches from `/api/prd`
- Board displays three status columns: Backlog, In Progress, Done
- Uses FeatureGroupList to render features grouped within each column
- Shows loading state during fetch, EmptyState for missing/error scenarios
- Stories distributed correctly based on passes field and startedAt
- Files created:
  - src/components/KanbanBoard.tsx (main board client component)
- Files modified:
  - src/app/page.tsx (now renders KanbanBoard)
- **Learnings for future iterations:**
  - Use "use client" directive for components that need useState/useEffect
  - KanbanBoard combines column rendering with FeatureGroupList for grouped display
  - getStoryCountByStatus helper calculates story counts across all features
  - Handle loading, error (fetch-error vs not-found), and empty features states
---

## 2026-02-13T18:17:00Z - US-010
- Implemented auto-refresh polling functionality in KanbanBoard component
- Added POLL_INTERVAL_MS constant (30000ms) for configurable polling interval
- Refactored fetchPrd to useCallback with isInitial parameter for different behaviors
- Initial fetch shows loading state and handles errors
- Polling fetches silently update data without visual flicker (keeps existing data on error)
- Polling cleans up on unmount via clearInterval
- Files modified:
  - src/components/KanbanBoard.tsx (added polling logic)
- **Learnings for future iterations:**
  - Use useCallback for fetch functions used in multiple useEffects to avoid recreating
  - Separate initial vs polling fetch behavior (isInitial parameter) for better UX
  - On polling errors, keep existing data to avoid flicker
  - setInterval with cleanup in useEffect for polling patterns
  - POLL_INTERVAL_MS constant at top of file for easy adjustment
---

## 2026-02-13T18:27:00Z - US-011
- Created ListView component with expandable feature sections
- FeatureSection sub-component with collapsible UI (chevron icon rotation)
- StoryRow sub-component displays ID, title, status indicator, time spent
- Progress bar in each section header showing X of Y completion
- Status color indicators: gray (backlog), blue (in-progress), green (done)
- Sections default to expanded, state managed via useState Set
- Files created:
  - src/components/ListView.tsx (list view UI component)
- **Learnings for future iterations:**
  - Use Set<string> for managing multiple expanded/collapsed states efficiently
  - Re-use getStoryStatus and formatDuration from existing components/utilities
  - Button with onClick for expandable sections (better accessibility than div)
  - Use truncate class for long titles, show full on hover or expansion
---

## 2026-02-13T18:35:00Z - US-012
- Implemented view toggle control to switch between Board and List views
- Created ViewToggle component with Board/List buttons and icons
- Created new Board component that combines data fetching with view switching
- View preference persisted in local storage (key: 'kanban-tracker-view')
- Smooth transitions between views using opacity and transition-opacity
- Toggle visible in header area beside project title
- Files created:
  - src/components/ViewToggle.tsx (toggle button component)
  - src/components/Board.tsx (main board component with view switching)
- Files modified:
  - src/app/page.tsx (now uses Board instead of KanbanBoard)
- **Learnings for future iterations:**
  - Use localStorage for view preference persistence with a clear key name
  - Load preference in useEffect to avoid SSR hydration mismatch
  - Use transition-opacity with absolute positioning for smooth view transitions
  - KanbanBoard.tsx still exists but Board.tsx is now the main component
  - ViewMode type ('board' | 'list') exported from ViewToggle.tsx
---

## 2026-02-13T18:24:49Z - US-013
- Implemented light/dark mode toggle with sun/moon icons
- ThemeToggle component manages theme state and persists to localStorage
- Theme preference saved with key 'kanban-tracker-theme'
- Respects system preference on first load (via prefers-color-scheme)
- Listens for system preference changes when no manual selection exists
- Configured Tailwind CSS v4 dark mode via @custom-variant directive
- Updated CSS variables for dark mode background (#0d1117)
- Files created:
  - src/components/ThemeToggle.tsx (theme toggle button component)
- Files modified:
  - src/app/globals.css (dark mode configuration)
  - src/components/Board.tsx (added ThemeToggle to header)
- **Learnings for future iterations:**
  - Tailwind CSS v4 uses @custom-variant for dark mode class selector
  - Use :root.dark for CSS variable overrides in dark mode
  - Render placeholder button until mounted to avoid hydration mismatch
  - Theme type ('light' | 'dark') exported from ThemeToggle.tsx
  - ThemeToggle applies 'dark' class to document.documentElement
---

## 2026-02-13T18:27:30Z - US-014
- Created PageHeader component with sticky positioning and project info
- Header shows project name from prd.json
- Displays overall progress (X of Y stories complete) with progress bar and percentage
- Includes ViewToggle and ThemeToggle controls
- Sticky positioning with backdrop blur for visual appeal while scrolling
- Responsive layout: controls stack below title on mobile, inline on larger screens
- Files created:
  - src/components/PageHeader.tsx (page header component)
- Files modified:
  - src/components/Board.tsx (now uses PageHeader instead of inline header)
- **Learnings for future iterations:**
  - Use sticky positioning with z-10 for fixed headers that stay above content
  - backdrop-blur-sm with semi-transparent bg gives modern glass effect
  - getOverallProgress helper calculates story completion across all features
  - PageHeader accepts prd, viewMode, and onViewChange props
---

## 2026-02-13T18:31:05Z - US-015
- Made board fully mobile-responsive with horizontal snap scroll
- Added snap-x snap-mandatory for column scrolling on mobile (< sm breakpoint)
- Set column width to 85vw on mobile with flex-shrink-0 and snap-center
- Improved touch targets with min-h-[36px] min-w-[36px] for buttons (44px recommended)
- Added touch-manipulation CSS for faster touch response
- Added active:scale-95 visual feedback for touch interactions
- Optimized PageHeader: condensed progress text, single-row layout on mobile
- Improved StoryCard: min-height, larger status indicators, better line-height
- Enhanced ListView: min-height rows, touch feedback on tap
- Files modified:
  - src/components/Board.tsx (snap scroll for mobile columns)
  - src/components/StoryCard.tsx (touch targets, spacing)
  - src/components/PageHeader.tsx (mobile layout optimization)
  - src/components/ViewToggle.tsx (touch targets)
  - src/components/ThemeToggle.tsx (touch targets)
  - src/components/ListView.tsx (row heights, touch feedback)
- **Learnings for future iterations:**
  - Use snap-x snap-mandatory for horizontal carousel scrolling on mobile
  - 85vw column width with snap-center creates a nice peek of adjacent columns
  - touch-manipulation CSS property prevents 300ms touch delay
  - Use active:scale-95 on mobile, reset to scale-100 on sm: breakpoint
  - min-h-[36px] or min-h-[44px] ensures touch targets meet accessibility guidelines
  - Use -mx-4 px-4 pattern to extend scroll area edge-to-edge on mobile
---

